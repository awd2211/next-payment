# Payment Platform Architecture

> **å•†ä¸šæ”¯ä»˜å¹³å°å®Œæ•´æ¶æ„** - 30ä¸ªå¾®æœåŠ¡è®¾è®¡
> æœ€åæ›´æ–°ï¼š2025-10-23

---

## ğŸ¯ æ¶æ„æ¦‚è§ˆ

### æ€»ä½“è§„æ¨¡
- **æœåŠ¡æ€»æ•°**ï¼š30ä¸ªå¾®æœåŠ¡
- **å½“å‰å·²å®ç°**ï¼š10ä¸ªæœåŠ¡
- **å³å°†æ‹†åˆ†**ï¼š5ä¸ªæœåŠ¡ï¼ˆä»ç°æœ‰æœåŠ¡ä¸­æ‹†åˆ†ï¼‰
- **æœªæ¥æ‰©å±•**ï¼š15ä¸ªæœåŠ¡ï¼ˆTier 1-3 æ–°å¢ï¼‰
- **æ•°æ®åº“**ï¼š31ä¸ªç‹¬ç«‹æ•°æ®åº“
- **ç«¯å£èŒƒå›´**ï¼š8001-8040

### æ¶æ„åŸåˆ™
âœ… **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæœåŠ¡ä¸“æ³¨ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ
âœ… **æ•°æ®åº“ç‹¬ç«‹**ï¼šDatabase per Service
âœ… **é¢†åŸŸé©±åŠ¨**ï¼šåŸºäºDDDåˆ’åˆ†æœåŠ¡è¾¹ç•Œ
âœ… **æ¾è€¦åˆ**ï¼šé€šè¿‡API/äº‹ä»¶é€šä¿¡
âœ… **å¯ç‹¬ç«‹éƒ¨ç½²**ï¼šæ¯ä¸ªæœåŠ¡ç‹¬ç«‹å‘å¸ƒ

---

## ğŸ“¦ æœåŠ¡æ¸…å•ï¼ˆæŒ‰é¢†åŸŸåˆ†ç»„ï¼‰

### 1ï¸âƒ£ æ ¸å¿ƒæ”¯ä»˜åŸŸ (Payment Domain)
**èŒè´£**ï¼šå¤„ç†æ”¯ä»˜äº¤æ˜“çš„æ ¸å¿ƒæµç¨‹

| # | æœåŠ¡å | ç«¯å£ | æ•°æ®åº“ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|---|--------|------|--------|------|--------|
| 1 | payment-gateway | 8003 | payment_gateway | âœ… å·²å®ç° | P0 |
| 2 | order-service | 8004 | payment_order | âœ… å·²å®ç° | P0 |
| 3 | channel-adapter | 8005 | payment_channel | âœ… å·²å®ç° | P0 |
| 4 | risk-service | 8006 | payment_risk | âœ… å·²å®ç° | P0 |
| 5 | routing-service | 8029 | payment_routing | ğŸ”® Tier 2 | P2 |

**æ ¸å¿ƒæµç¨‹**ï¼š
```
Merchant â†’ payment-gateway â†’ risk-service â†’ order-service â†’ channel-adapter â†’ Stripe/PayPal
```

---

### 2ï¸âƒ£ å•†æˆ·ç®¡ç†åŸŸ (Merchant Domain)
**èŒè´£**ï¼šå•†æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†

| # | æœåŠ¡å | ç«¯å£ | æ•°æ®åº“ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|---|--------|------|--------|------|--------|
| 6 | merchant-service | 8002 | payment_merchant | âœ… å·²å®ç°ï¼ˆéœ€æ‹†åˆ†ï¼‰ | P0 |
| 7 | merchant-auth-service | 8011 | payment_merchant_auth | ğŸ“‹ å¾…æ‹†åˆ† | P1 |
| 8 | kyc-service | 8014 | payment_kyc | ğŸ“‹ å¾…æ‹†åˆ† | P2 |
| 9 | merchant-config-service | 8015 | payment_merchant_config | ğŸ“‹ å¾…æ‹†åˆ† | P2 |

**æ‹†åˆ†è¯´æ˜**ï¼š
- **merchant-service**ï¼šä¿ç•™æ ¸å¿ƒå•†æˆ·ä¿¡æ¯ï¼ˆMerchant, MerchantUser, SettlementAccountï¼‰
- **merchant-auth-service**ï¼šæ‹†åˆ†å®‰å…¨è®¤è¯ï¼ˆ2FA, Login, Session, PasswordHistoryï¼‰
- **kyc-service**ï¼šæ‹†åˆ†KYCå®¡æ ¸ï¼ˆKYCDocument, BusinessQualificationï¼‰
- **merchant-config-service**ï¼šæ‹†åˆ†é…ç½®ç®¡ç†ï¼ˆAPIKey, ChannelConfig, FeeConfig, TransactionLimitï¼‰

---

### 3ï¸âƒ£ è´¢åŠ¡ç»“ç®—åŸŸ (Finance Domain)
**èŒè´£**ï¼šèµ„é‡‘æµè½¬å’Œç»“ç®—ç®¡ç†

| # | æœåŠ¡å | ç«¯å£ | æ•°æ®åº“ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|---|--------|------|--------|------|--------|
| 10 | accounting-service | 8008 | payment_accounting | âœ… å·²å®ç°ï¼ˆéœ€æ‹†åˆ†ï¼‰ | P0 |
| 11 | settlement-service | 8012 | payment_settlement | ğŸ“‹ å¾…æ‹†åˆ† | P1 |
| 12 | withdrawal-service | 8013 | payment_withdrawal | ğŸ“‹ å¾…æ‹†åˆ† | P1 |
| 13 | billing-service | 8023 | payment_billing | ğŸ”® Tier 1 | P1 |
| 14 | payout-service | 8028 | payment_payout | ğŸ”® Tier 2 | P2 |
| 15 | reconciliation-service | 8021 | payment_reconciliation | ğŸ”® Tier 1 | P1 |

**æ‹†åˆ†è¯´æ˜**ï¼š
- **accounting-service**ï¼šä¿ç•™è´¦åŠ¡è®°è´¦ï¼ˆAccount, AccountTransaction, DoubleEntryï¼‰
- **settlement-service**ï¼šæ‹†åˆ†ç»“ç®—å¤„ç†ï¼ˆSettlementï¼Œæ‰¹é‡ç»“ç®—ï¼‰
- **withdrawal-service**ï¼šæ‹†åˆ†æç°ç®¡ç†ï¼ˆWithdrawalï¼Œå®¡æ‰¹æµç¨‹ï¼‰

---

### 4ï¸âƒ£ äº‰è®®å¤„ç†åŸŸ (Dispute Domain)
**èŒè´£**ï¼šæ‹’ä»˜å’Œäº‰è®®ç®¡ç†

| # | æœåŠ¡å | ç«¯å£ | æ•°æ®åº“ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|---|--------|------|--------|------|--------|
| 16 | dispute-service | 8020 | payment_dispute | ğŸ”® Tier 1 | P1 |

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- Chargebackå¤„ç†
- äº‰è®®è¯æ®ä¸Šä¼ 
- è‡ªåŠ¨å†»ç»“äº‰è®®é‡‘é¢
- ä¸accounting-serviceè”åŠ¨

---

### 5ï¸âƒ£ åˆè§„ç›‘ç®¡åŸŸ (Compliance Domain)
**èŒè´£**ï¼šåˆè§„å’Œå®¡è®¡

| # | æœåŠ¡å | ç«¯å£ | æ•°æ®åº“ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|---|--------|------|--------|------|--------|
| 17 | compliance-service | 8022 | payment_compliance | ğŸ”® Tier 1 | P1 |
| 18 | audit-service | 8025 | payment_audit | ğŸ”® Tier 1 | P1 |

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- AMLï¼ˆåæ´—é’±ï¼‰æ£€æŸ¥
- KYTï¼ˆäº†è§£ä½ çš„äº¤æ˜“ï¼‰
- å¤§é¢äº¤æ˜“è‡ªåŠ¨æŠ¥å‘Š
- æ“ä½œå®¡è®¡æ—¥å¿—

---

### 6ï¸âƒ£ å¹³å°ç®¡ç†åŸŸ (Platform Domain)
**èŒè´£**ï¼šå¹³å°è¿è¥å’Œç®¡ç†

| # | æœåŠ¡å | ç«¯å£ | æ•°æ®åº“ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|---|--------|------|--------|------|--------|
| 19 | admin-service | 8001 | payment_admin | âœ… å·²å®ç° | P0 |
| 20 | config-service | 8010 | payment_config | âœ… å·²å®ç° | P0 |
| 21 | notification-service | 8007 | payment_notification | âœ… å·²å®ç° | P0 |
| 22 | analytics-service | 8009 | payment_analytics | âœ… å·²å®ç° | P0 |
| 23 | report-service | 8024 | payment_report | ğŸ”® Tier 1 | P1 |
| 24 | webhook-service | 8026 | payment_webhook | ğŸ”® Tier 2 | P2 |

---

### 7ï¸âƒ£ é«˜çº§åŠŸèƒ½åŸŸ (Advanced Features Domain)
**èŒè´£**ï¼šé«˜çº§å•†ä¸šåŠŸèƒ½

| # | æœåŠ¡å | ç«¯å£ | æ•°æ®åº“ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|---|--------|------|--------|------|--------|
| 25 | subscription-service | 8027 | payment_subscription | ğŸ”® Tier 2 | P2 |
| 26 | fraud-detection-service | 8030 | payment_fraud | ğŸ”® Tier 2 | P2 |
| 27 | identity-service | 8031 | payment_identity | ğŸ”® Tier 2 | P3 |
| 28 | document-service | 8032 | payment_document | ğŸ”® Tier 2 | P3 |
| 29 | marketplace-service | 8033 | payment_marketplace | ğŸ”® Tier 3 | P3 |
| 30 | currency-service | 8034 | payment_currency | ğŸ”® Tier 3 | P3 |

---

## ğŸ—ºï¸ æœåŠ¡ä¾èµ–å…³ç³»å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Merchant App   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ payment-gateway â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”˜
                         â”‚    â”‚   â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚             â”‚    â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â–¼â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ risk-serviceâ”‚ â”‚order-serviceâ”‚     â”‚channel-adapter â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                    â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚            â”‚                    â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚accounting-serviceâ”‚ â”‚settlement-serviceâ”‚ â”‚ Stripe API â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ä¼˜å…ˆçº§å®šä¹‰

| ä¼˜å…ˆçº§ | è¯´æ˜ | æ—¶é—´çº¿ |
|--------|------|--------|
| P0 | æ ¸å¿ƒåŠŸèƒ½ï¼Œå·²å®ç° | å½“å‰ |
| P1 | å¿…éœ€åŠŸèƒ½ï¼Œç«‹å³å¯åŠ¨ | 0-3ä¸ªæœˆ |
| P2 | é‡è¦åŠŸèƒ½ï¼Œè®¡åˆ’ä¸­ | 3-6ä¸ªæœˆ |
| P3 | é«˜çº§åŠŸèƒ½ï¼Œé•¿æœŸè§„åˆ’ | 6-12ä¸ªæœˆ |

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### æœåŠ¡å±‚
- **è¯­è¨€**ï¼šGo 1.21+
- **æ¡†æ¶**ï¼šGin (HTTP), gRPC (æœåŠ¡é—´é€šä¿¡)
- **ä¾èµ–ç®¡ç†**ï¼šGo Workspace

### æ•°æ®å±‚
- **å…³ç³»æ•°æ®åº“**ï¼šPostgreSQL 15
- **ç¼“å­˜**ï¼šRedis 7
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šKafka (äº‹ä»¶é©±åŠ¨)

### åŸºç¡€è®¾æ–½
- **æœåŠ¡å‘ç°**ï¼šConsul / Nacosï¼ˆå¾…å¼•å…¥ï¼‰
- **APIç½‘å…³**ï¼šKong / APISIXï¼ˆå¾…å¼•å…¥ï¼‰
- **å®¹å™¨ç¼–æ’**ï¼šKubernetesï¼ˆå¾…å¼•å…¥ï¼‰

### å¯è§‚æµ‹æ€§
- **æŒ‡æ ‡ç›‘æ§**ï¼šPrometheus + Grafana
- **åˆ†å¸ƒå¼è¿½è¸ª**ï¼šJaeger
- **æ—¥å¿—èšåˆ**ï¼šå¾…å¼•å…¥ï¼ˆELK/Lokiï¼‰
- **å‘Šè­¦**ï¼šAlertmanager

---

## ğŸš€ å®æ–½è·¯çº¿å›¾

### Q1ï¼ˆ0-3ä¸ªæœˆï¼‰ï¼šæ ¸å¿ƒæ‹†åˆ†
1. merchant-auth-serviceï¼ˆ2å‘¨ï¼‰
2. settlement-serviceï¼ˆ3å‘¨ï¼‰
3. withdrawal-serviceï¼ˆ4å‘¨ï¼‰
4. dispute-serviceï¼ˆ3å‘¨ï¼‰

### Q2ï¼ˆ3-6ä¸ªæœˆï¼‰ï¼šä¸šåŠ¡å®Œå–„
5. kyc-serviceï¼ˆ3å‘¨ï¼‰
6. merchant-config-serviceï¼ˆ3å‘¨ï¼‰
7. reconciliation-serviceï¼ˆ4å‘¨ï¼‰
8. billing-serviceï¼ˆ4å‘¨ï¼‰

### Q3ï¼ˆ6-9ä¸ªæœˆï¼‰ï¼šé«˜çº§åŠŸèƒ½
9. subscription-serviceï¼ˆ3å‘¨ï¼‰
10. routing-serviceï¼ˆ3å‘¨ï¼‰
11. fraud-detection-serviceï¼ˆ4å‘¨ï¼‰
12. webhook-serviceï¼ˆ2å‘¨ï¼‰

### Q4ï¼ˆ9-12ä¸ªæœˆï¼‰ï¼šåŸºç¡€è®¾æ–½
13. å¼•å…¥æœåŠ¡å‘ç°ï¼ˆConsulï¼‰
14. å¼•å…¥APIç½‘å…³ï¼ˆKongï¼‰
15. Kuberneteséƒ¨ç½²
16. å®Œå–„ç›‘æ§å‘Šè­¦

---

## ğŸ“ å‘½åè§„èŒƒ

### æœåŠ¡å‘½å
```
{domain}-service
ä¾‹å¦‚ï¼špayment-gateway, merchant-auth-service
```

### æ•°æ®åº“å‘½å
```
payment_{domain}
ä¾‹å¦‚ï¼špayment_merchant_auth, payment_settlement
```

### ç«¯å£åˆ†é…
```
8001-8010: å½“å‰å·²å®ç°æœåŠ¡
8011-8020: æ‹†åˆ†æœåŠ¡
8021-8030: Tier 1 å¿…éœ€æœåŠ¡
8031-8040: Tier 2-3 é«˜çº§æœåŠ¡
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [SERVICE_PORTS.md](./backend/docs/SERVICE_PORTS.md) - ç«¯å£åˆ†é…æ˜ç»†
- [ROADMAP.md](./ROADMAP.md) - è¯¦ç»†å®æ–½è·¯çº¿å›¾
- [CLAUDE.md](./CLAUDE.md) - å¼€å‘æŒ‡å—ï¼ˆClaude Codeä¸“ç”¨ï¼‰

---

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰æ¶æ„é—®é¢˜ï¼Œè¯·è”ç³»æ¶æ„å›¢é˜Ÿã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**ç»´æŠ¤äºº**ï¼šæ¶æ„å›¢é˜Ÿ
**å®¡æ ¸çŠ¶æ€**ï¼šå¾…å®¡æ ¸
