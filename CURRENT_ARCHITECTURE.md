# 全球支付平台 - 现有架构图

> **当前实际运行的微服务架构**
> 最后更新：2025-10-24

---

## 🎯 系统概览

### 实际规模
- **微服务总数**：16个（全部已实现）
- **数据库数量**：16个独立PostgreSQL数据库
- **前端应用**：3个（Admin Portal、Merchant Portal、Website）
- **基础设施**：PostgreSQL、Redis、Kafka、Prometheus、Grafana、Jaeger、Kong

---

## 📐 完整系统架构图

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                外部用户层                                            │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   ┌─────────────┐         ┌─────────────┐         ┌─────────────┐                 │
│   │平台管理员    │         │   商户      │         │  终端用户    │                 │
│   │ Admin       │         │  Merchant   │         │  End User   │                 │
│   └──────┬──────┘         └──────┬──────┘         └──────┬──────┘                 │
│          │                       │                       │                         │
│          ▼                       ▼                       ▼                         │
│   ┌─────────────┐         ┌─────────────┐         ┌─────────────┐                 │
│   │Admin Portal │         │Merchant     │         │  Website    │                 │
│   │   :5173     │         │Portal :5174 │         │   :5175     │                 │
│   │React+Vite   │         │React+Vite   │         │React+Vite   │                 │
│   │Ant Design   │         │Ant Design   │         │Ant Design   │                 │
│   │12语言支持   │         │多货币看板   │         │官网营销     │                 │
│   └──────┬──────┘         └──────┬──────┘         └─────────────┘                 │
│          │                       │                                                 │
└──────────┼───────────────────────┼─────────────────────────────────────────────────┘
           │                       │
           │                       │
┌──────────┼───────────────────────┼─────────────────────────────────────────────────┐
│          │    API Gateway Layer (Optional - Kong on :8000)                        │
│          │                       │                                                 │
└──────────┼───────────────────────┼─────────────────────────────────────────────────┘
           │                       │
           ▼                       ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          微服务层 (16个服务 - HTTP/REST通信)                         │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ╔═══════════════════════════════════════════════════════════════════════════════╗ │
│  ║                     🏦 核心支付域 (Payment Domain)                            ║ │
│  ╠═══════════════════════════════════════════════════════════════════════════════╣ │
│  ║                                                                               ║ │
│  ║   ┌─────────────────────────────────────────────────────────────────┐        ║ │
│  ║   │  payment-gateway  :40003  (payment_gateway)                     │        ║ │
│  ║   │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │        ║ │
│  ║   │  🎯 核心编排者 - 整个支付流程的指挥中心                          │        ║ │
│  ║   │  ✅ 商户签名验证 (HMAC-SHA256)                                   │        ║ │
│  ║   │  ✅ 幂等性保护 (Redis 5分钟)                                     │        ║ │
│  ║   │  ✅ Saga事务编排 (分布式事务)                                    │        ║ │
│  ║   │  ✅ Webhook接收 (Stripe回调)                                     │        ║ │
│  ║   └─────────┬───────────────┬──────────────┬─────────────┘                   ║ │
│  ║             │               │              │                                 ║ │
│  ║   ┌─────────▼──────┐  ┌────▼──────┐  ┌───▼──────────┐                       ║ │
│  ║   │order-service   │  │risk-service│  │channel-adapter│                      ║ │
│  ║   │:40004          │  │:40006      │  │:40005         │                      ║ │
│  ║   │                │  │            │  │               │                      ║ │
│  ║   │📦 订单管理     │  │🛡️ 风控引擎 │  │🔌 渠道适配器   │                      ║ │
│  ║   │• 订单创建      │  │• 风险评估  │  │• Stripe ✅    │                      ║ │
│  ║   │• 状态更新      │  │• IP黑名单  │  │• PayPal ⏳    │                      ║ │
│  ║   │• 订单查询      │  │• 规则引擎  │  │• Crypto ⏳    │                      ║ │
│  ║   │• Kafka事件     │  │• GeoIP检测 │  │• Adapter模式  │                      ║ │
│  ║   └────────────────┘  └────────────┘  └───────┬───────┘                      ║ │
│  ║                                               │                              ║ │
│  ║                                               ▼                              ║ │
│  ║                                        ┌──────────────┐                      ║ │
│  ║                                        │ Stripe API   │                      ║ │
│  ║                                        │ (外部服务)    │                      ║ │
│  ║                                        └──────────────┘                      ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════╝ │
│                                                                                     │
│  ╔═══════════════════════════════════════════════════════════════════════════════╗ │
│  ║                     👥 商户管理域 (Merchant Domain)                           ║ │
│  ╠═══════════════════════════════════════════════════════════════════════════════╣ │
│  ║                                                                               ║ │
│  ║   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐          ║ │
│  ║   │merchant-service  │  │merchant-auth     │  │merchant-config   │          ║ │
│  ║   │:40002            │  │:40011            │  │:40012            │          ║ │
│  ║   │                  │  │                  │  │                  │          ║ │
│  ║   │🏢 商户主数据     │  │🔐 认证服务       │  │⚙️ 配置管理        │          ║ │
│  ║   │• 商户注册        │  │• API密钥管理     │  │• 渠道配置        │          ║ │
│  ║   │• 基本信息        │  │• 签名验证        │  │• 费率配置        │          ║ │
│  ║   │• 账户管理        │  │• Token刷新       │  │• 交易限额        │          ║ │
│  ║   │• 商户审核        │  │• 权限控制        │  │• Webhook配置     │          ║ │
│  ║   └──────────────────┘  └──────────────────┘  └──────────────────┘          ║ │
│  ║                                                                               ║ │
│  ║   ┌──────────────────┐                                                       ║ │
│  ║   │kyc-service       │                                                       ║ │
│  ║   │:40015            │                                                       ║ │
│  ║   │                  │                                                       ║ │
│  ║   │📄 KYC验证        │                                                       ║ │
│  ║   │• 身份验证        │                                                       ║ │
│  ║   │• 文档审核        │                                                       ║ │
│  ║   │• 企业资质        │                                                       ║ │
│  ║   │• 合规检查        │                                                       ║ │
│  ║   └──────────────────┘                                                       ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════╝ │
│                                                                                     │
│  ╔═══════════════════════════════════════════════════════════════════════════════╗ │
│  ║                     💰 财务结算域 (Finance Domain)                            ║ │
│  ╠═══════════════════════════════════════════════════════════════════════════════╣ │
│  ║                                                                               ║ │
│  ║   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐          ║ │
│  ║   │accounting        │  │settlement        │  │withdrawal        │          ║ │
│  ║   │:40007            │  │:40013            │  │:40014            │          ║ │
│  ║   │                  │  │                  │  │                  │          ║ │
│  ║   │📒 会计服务       │  │💸 结算服务       │  │💵 提现服务        │          ║ │
│  ║   │• 复式记账        │  │• T+1结算         │  │• 提现申请        │          ║ │
│  ║   │• 账本管理        │  │• 批量结算        │  │• 审核流程        │          ║ │
│  ║   │• 交易记录        │  │• 对账处理        │  │• 打款处理        │          ║ │
│  ║   │• 余额查询        │  │• 结算报表        │  │• 状态追踪        │          ║ │
│  ║   └──────────────────┘  └──────────────────┘  └──────────────────┘          ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════╝ │
│                                                                                     │
│  ╔═══════════════════════════════════════════════════════════════════════════════╗ │
│  ║                     🏛️ 平台管理域 (Platform Domain)                          ║ │
│  ╠═══════════════════════════════════════════════════════════════════════════════╣ │
│  ║                                                                               ║ │
│  ║   ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐          ║ │
│  ║   │admin-service     │  │config-service    │  │notification      │          ║ │
│  ║   │:40001            │  │:40010            │  │:40008            │          ║ │
│  ║   │                  │  │                  │  │                  │          ║ │
│  ║   │👨‍💼 管理后台      │  │⚙️ 配置中心       │  │📧 通知服务        │          ║ │
│  ║   │• 用户管理        │  │• 系统配置        │  │• 邮件发送        │          ║ │
│  ║   │• 角色权限 RBAC   │  │• 路由规则        │  │• SMS发送         │          ║ │
│  ║   │• 操作日志        │  │• 渠道配置        │  │• Webhook推送     │          ║ │
│  ║   │• JWT认证         │  │• 费率模板        │  │• 模板管理        │          ║ │
│  ║   └──────────────────┘  └──────────────────┘  └──────────────────┘          ║ │
│  ║                                                                               ║ │
│  ║   ┌──────────────────┐  ┌──────────────────┐                                ║ │
│  ║   │analytics         │  │cashier-service   │                                ║ │
│  ║   │:40009            │  │:40016            │                                ║ │
│  ║   │                  │  │                  │                                ║ │
│  ║   │📊 数据分析       │  │🛒 收银台         │                                ║ │
│  ║   │• 交易统计        │  │• 支付页面        │                                ║ │
│  ║   │• 商户报表        │  │• 多渠道展示      │                                ║ │
│  ║   │• 趋势分析        │  │• 用户支付        │                                ║ │
│  ║   │• BI看板          │  │• 支付结果页      │                                ║ │
│  ║   └──────────────────┘  └──────────────────┘                                ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════╝ │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
           │              │              │              │              │
           │              │              │              │              │
           ▼              ▼              ▼              ▼              ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              数据存储层 (Data Layer)                                 │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌───────────────────────────────────────────────────────────────────────────────┐ │
│  │                PostgreSQL :40432 (16个独立数据库)                             │ │
│  ├───────────────────────────────────────────────────────────────────────────────┤ │
│  │  payment_gateway      │  payment_order         │  payment_channel            │ │
│  │  payment_risk         │  payment_accounting    │  payment_merchant           │ │
│  │  payment_admin        │  payment_config        │  payment_notification       │ │
│  │  payment_analytics    │  payment_merchant_auth │  payment_merchant_config    │ │
│  │  payment_settlement   │  payment_withdrawal    │  payment_kyc                │ │
│  │  payment_cashier      │                        │                             │ │
│  │                                                                               │ │
│  │  📌 每个服务独立数据库实现服务隔离和多租户架构                                 │ │
│  └───────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  ┌──────────────────────┐        ┌──────────────────────┐                         │
│  │  Redis :40379        │        │  Kafka :40092        │                         │
│  │  ━━━━━━━━━━━━━━━━    │        │  ━━━━━━━━━━━━━━━━    │                         │
│  │  🔴 缓存+幂等+限流   │        │  📨 事件驱动+异步    │                         │
│  │                      │        │                      │                         │
│  │  • 幂等性缓存        │        │  • 支付完成事件      │                         │
│  │  • 分布式锁          │        │  • 订单状态变更      │                         │
│  │  • 热点数据缓存      │        │  • 结算触发事件      │                         │
│  │  • 限流计数器        │        │  • 通知消息队列      │                         │
│  │  • Session存储       │        │  • 审计日志流        │                         │
│  └──────────────────────┘        └──────────────────────┘                         │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
           │                          │                          │
           │                          │                          │
           ▼                          ▼                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                         可观测性层 (Observability Stack)                             │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌──────────────────┐      ┌──────────────────┐      ┌──────────────────┐         │
│  │ Prometheus       │─────▶│  Grafana         │      │  Jaeger          │         │
│  │ :40090           │      │  :40300          │      │  :40686          │         │
│  │                  │      │                  │      │                  │         │
│  │📈 指标采集       │      │📊 可视化仪表板   │      │🔍 分布式追踪     │         │
│  │                  │      │                  │      │                  │         │
│  │• HTTP指标        │      │• 系统监控看板    │      │• W3C上下文传播   │         │
│  │• 业务指标        │      │• 支付业务看板    │      │• 全链路追踪      │         │
│  │• 支付成功率      │      │• 告警规则        │      │• 性能分析        │         │
│  │• P95延迟         │      │• admin/admin     │      │• 依赖关系图      │         │
│  │• 交易金额        │      │                  │      │                  │         │
│  └──────────────────┘      └──────────────────┘      └──────────────────┘         │
│           ▲                         ▲                         ▲                    │
│           │                         │                         │                    │
│           └─────────────────────────┴─────────────────────────┘                    │
│                     所有服务通过中间件自动上报                                       │
│                                                                                     │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐                 │
│  │Postgres Exporter │  │ Redis Exporter   │  │ Kafka Exporter   │                 │
│  │:9187             │  │ :9121            │  │ :9308            │                 │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘                 │
│                                                                                     │
│  ┌──────────────────┐  ┌──────────────────┐                                       │
│  │  cAdvisor        │  │  Node Exporter   │                                       │
│  │  :8080           │  │  :9100           │                                       │
│  └──────────────────┘  └──────────────────┘                                       │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🔄 核心支付流程时序图

```
商户系统              Payment Gateway         Risk Service      Order Service    Channel Adapter      Stripe
  │                        │                        │                 │                 │              │
  │ 1. POST /api/v1/payments (带签名)                                                                  │
  ├───────────────────────▶│                        │                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 2. 验证签名 (HMAC-SHA256)                │                 │              │
  │                        │────────┐               │                 │                 │              │
  │                        │        │               │                 │                 │              │
  │                        │◀───────┘               │                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 3. 检查幂等性 (Redis)  │                 │                 │              │
  │                        │────────┐               │                 │                 │              │
  │                        │        │               │                 │                 │              │
  │                        │◀───────┘               │                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 4. 调用风控评估         │                 │                 │              │
  │                        ├───────────────────────▶│                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │                        │ 5. IP检测/规则引擎                │              │
  │                        │                        │────────┐        │                 │              │
  │                        │                        │        │        │                 │              │
  │                        │                        │◀───────┘        │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ ◀─ 风险评估结果(PASS)   │                 │                 │              │
  │                        │◀───────────────────────┤                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 6. 生成payment_no      │                 │                 │              │
  │                        │────────┐               │                 │                 │              │
  │                        │        │               │                 │                 │              │
  │                        │◀───────┘               │                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 7. 创建订单             │                 │                 │              │
  │                        ├────────────────────────┼────────────────▶│                 │              │
  │                        │                        │                 │                 │              │
  │                        │ ◀─ order_no            │                 │                 │              │
  │                        │◀────────────────────────┼─────────────────┤                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 8. 选择支付渠道(Stripe) │                 │                 │              │
  │                        │────────┐               │                 │                 │              │
  │                        │        │               │                 │                 │              │
  │                        │◀───────┘               │                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 9. 调用渠道适配器       │                 │                 │              │
  │                        ├────────────────────────┼─────────────────┼────────────────▶│              │
  │                        │                        │                 │                 │              │
  │                        │                        │                 │                 │ 10. CreatePaymentIntent
  │                        │                        │                 │                 ├─────────────▶│
  │                        │                        │                 │                 │              │
  │                        │                        │                 │                 │ ◀─ client_secret
  │                        │                        │                 │                 │◀─────────────┤
  │                        │                        │                 │                 │              │
  │                        │ ◀─ payment_url         │                 │                 │              │
  │                        │◀────────────────────────┼─────────────────┼─────────────────┤              │
  │                        │                        │                 │                 │              │
  │                        │ 11. 保存支付记录(pending)                 │                 │              │
  │                        │────────┐               │                 │                 │              │
  │                        │        │               │                 │                 │              │
  │                        │◀───────┘               │                 │                 │              │
  │                        │                        │                 │                 │              │
  │ ◀─ {payment_url, payment_no}                    │                 │                 │              │
  │◀───────────────────────┤                        │                 │                 │              │
  │                        │                        │                 │                 │              │
  │ 12. 跳转支付页面       │                        │                 │                 │              │
  │                        │                        │                 │                 │              │
  │                                                                                                     │
  ┌─────────────────────────────────────  异步Webhook回调  ──────────────────────────────────────────┐
  │                        │                        │                 │                 │              │
  │                        │ 13. POST /webhooks/stripe (Webhook Event)                 │              │
  │                        │◀────────────────────────┼─────────────────┼─────────────────┼──────────────┤
  │                        │                        │                 │                 │              │
  │                        │ 14. 验证Stripe签名      │                 │                 │              │
  │                        │────────┐               │                 │                 │              │
  │                        │        │               │                 │                 │              │
  │                        │◀───────┘               │                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 15. 更新支付状态(success)                 │                 │              │
  │                        │────────┐               │                 │                 │              │
  │                        │        │               │                 │                 │              │
  │                        │◀───────┘               │                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 16. 更新订单状态        │                 │                 │              │
  │                        ├────────────────────────┼────────────────▶│                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 17. 发布Kafka事件(支付完成)               │                 │              │
  │                        │────────┐               │                 │                 │              │
  │                        │        │               │                 │                 │              │
  │                        │◀───────┘               │                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 18. 触发会计记账(Accounting)              │                 │              │
  │                        │────────┐               │                 │                 │              │
  │                        │        │               │                 │                 │              │
  │                        │◀───────┘               │                 │                 │              │
  │                        │                        │                 │                 │              │
  │                        │ 19. 发送商户回调通知(Notification)        │                 │              │
  │                        │────────┐               │                 │                 │              │
  │                        │        │               │                 │                 │              │
  │                        │◀───────┘               │                 │                 │              │
  │                        │                        │                 │                 │              │
  │ ◀─ HTTP Webhook (支付成功)                      │                 │                 │              │
  │◀───────────────────────┤                        │                 │                 │              │
  │                        │                        │                 │                 │              │
  └─────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 📊 服务详细清单

| # | 服务名 | 端口 | 数据库 | 主要功能 | Bootstrap迁移 |
|---|--------|------|--------|----------|---------------|
| 1 | admin-service | 40001 | payment_admin | 管理员/角色/权限管理, RBAC | ✅ 36%代码减少 |
| 2 | merchant-service | 40002 | payment_merchant | 商户注册/管理/审核 | ✅ 24%代码减少 |
| 3 | payment-gateway | 40003 | payment_gateway | 支付网关/编排/签名验证 | ✅ 28%代码减少 |
| 4 | order-service | 40004 | payment_order | 订单创建/状态管理 | ✅ 37%代码减少 |
| 5 | channel-adapter | 40005 | payment_channel | 支付渠道适配(Stripe/PayPal) | ✅ 32%代码减少 |
| 6 | risk-service | 40006 | payment_risk | 风险评估/黑名单/规则引擎 | ✅ 48%代码减少 |
| 7 | accounting-service | 40007 | payment_accounting | 复式记账/账本管理 | ✅ 58%代码减少 |
| 8 | notification-service | 40008 | payment_notification | 邮件/SMS/Webhook通知 | ✅ 26%代码减少 |
| 9 | analytics-service | 40009 | payment_analytics | 数据分析/报表/BI | ✅ 80%代码减少 🏆 |
| 10 | config-service | 40010 | payment_config | 配置中心/路由规则 | ✅ 46%代码减少 |
| 11 | merchant-auth-service | 40011 | payment_merchant_auth | API密钥/签名验证/Token | ✅ 已迁移 |
| 12 | merchant-config-service | 40012 | payment_merchant_config | 商户配置/渠道配置/费率 | ✅ 已迁移 |
| 13 | settlement-service | 40013 | payment_settlement | T+1结算/批量结算/对账 | ✅ 已迁移 |
| 14 | withdrawal-service | 40014 | payment_withdrawal | 提现申请/审核/打款 | ✅ 已迁移 |
| 15 | kyc-service | 40015 | payment_kyc | KYC验证/文档审核 | ✅ 已迁移 |
| 16 | cashier-service | 40016 | payment_cashier | 收银台/支付页面 | ✅ 已迁移 |

**Bootstrap迁移进度**: 16/16 (100%) ✅ 🎉
**平均代码减少**: 35-40%
**所有服务已完成Bootstrap框架迁移！**

---

## 🏗️ 服务间依赖关系

```
payment-gateway (🎯 核心编排者)
    ├─▶ risk-service (风控评估)
    ├─▶ order-service (订单管理)
    ├─▶ channel-adapter (渠道调用)
    ├─▶ accounting-service (会计记账)
    └─▶ notification-service (消息通知)

merchant-service
    ├─▶ merchant-auth-service (认证管理)
    ├─▶ merchant-config-service (配置管理)
    └─▶ kyc-service (KYC验证)

settlement-service
    ├─▶ accounting-service (对账数据)
    └─▶ withdrawal-service (自动提现)

analytics-service
    └─▶ 所有服务 (数据聚合,只读)

channel-adapter
    └─▶ Stripe/PayPal API (外部渠道)
```

---

## 🛠️ 技术栈总览

### 后端微服务
- **语言**: Go 1.21+
- **HTTP框架**: Gin
- **ORM**: GORM
- **通信协议**: HTTP/REST (主要), gRPC (可选,默认关闭)
- **依赖管理**: Go Workspace (`go.work`)

### 共享库 (pkg/)
```
backend/pkg/
├── app/              # Bootstrap统一初始化框架 ⭐
├── auth/             # JWT认证
├── cache/            # Redis+内存缓存
├── config/           # 环境变量配置
├── db/               # PostgreSQL+Redis连接池
├── logger/           # Zap结构化日志
├── validator/        # 金额/货币/Luhn验证
├── email/            # SMTP/Mailgun邮件
├── httpclient/       # HTTP客户端(重试+熔断)
├── kafka/            # Kafka生产者/消费者
├── grpc/             # gRPC工具(可选)
├── metrics/          # Prometheus指标 ⭐
├── tracing/          # Jaeger追踪 ⭐
├── health/           # 健康检查 ⭐
├── middleware/       # Gin中间件(CORS/Auth/Metrics/Tracing) ⭐
├── crypto/           # 加密解密
├── currency/         # 货币转换
├── retry/            # 重试机制
└── migration/        # 数据库迁移
```

### 基础设施
- **数据库**: PostgreSQL 15 (16个独立数据库)
- **缓存**: Redis 7
- **消息队列**: Kafka 3.x + Zookeeper
- **API网关**: Kong 3.9 (可选)
- **容器化**: Docker + Docker Compose

### 可观测性
- **监控**: Prometheus + Grafana
- **追踪**: Jaeger (OpenTelemetry)
- **日志**: Zap
- **导出器**: Postgres Exporter, Redis Exporter, Kafka Exporter, cAdvisor, Node Exporter

### 前端应用
- **框架**: React 18 + TypeScript
- **构建**: Vite 5
- **UI**: Ant Design 5.15 + @ant-design/charts
- **状态**: Zustand 4.5
- **路由**: React Router v6
- **HTTP**: Axios
- **i18n**: react-i18next (12种语言)

---

## 🔐 安全机制

1. **签名验证**: HMAC-SHA256商户请求签名
2. **JWT认证**: Admin/Merchant Portal Token认证
3. **RBAC**: 基于角色的访问控制
4. **幂等性保护**: Redis 5分钟缓存
5. **限流**: 100请求/分钟(可配置)
6. **数据加密**: AES-256敏感数据加密
7. **Webhook验证**: Stripe签名验证
8. **审计日志**: 所有操作日志记录

---

## 🚀 高可用设计

1. **服务隔离**: 每服务独立数据库
2. **熔断器**: httpclient熔断机制
3. **重试机制**: 指数退避(最多3次)
4. **健康检查**: K8s readiness/liveness probes
5. **优雅关闭**: SIGINT/SIGTERM处理
6. **分布式事务**: Saga模式(payment-gateway)
7. **全链路追踪**: Jaeger监控定位

---

## 📈 性能优化

1. **Redis缓存**: 热点数据缓存
2. **连接池**: DB最大100/最小10
3. **批量操作**: 减少数据库RTT
4. **索引优化**: payment_no/order_no/merchant_id
5. **限流保护**: 防止系统过载
6. **异步处理**: Kafka事件异步
7. **追踪采样**: 生产10%采样率

---

## 📡 端口分配

### 微服务端口
| 端口范围 | 用途 |
|---------|------|
| 40001-40016 | 16个微服务 |

### 基础设施端口
| 服务 | 端口 |
|------|------|
| PostgreSQL | 40432 |
| Redis | 40379 |
| Kafka | 40092 |
| Zookeeper | 40181 |
| Kafka UI | 40080 |
| Kong Gateway | 8000, 8001, 8443, 8444 |
| Konga Admin | 1337 |
| Prometheus | 40090 |
| Grafana | 40300 |
| Jaeger | 40686, 14268, 6831/udp |
| Postgres Exporter | 9187 |
| Redis Exporter | 9121 |
| Kafka Exporter | 9308 |
| cAdvisor | 8080 |
| Node Exporter | 9100 |

### 前端应用端口
| 应用 | 端口 |
|------|------|
| Admin Portal | 5173 |
| Merchant Portal | 5174 |
| Website | 5175 |

---

## 🎯 项目状态

### 当前进度: 90% (生产就绪)

✅ **已完成**:
- 16个微服务全部实现
- Stripe支付集成(创建/查询/退款/Webhook)
- 完整可观测性(Prometheus+Grafana+Jaeger)
- Admin+Merchant Portal
- 多租户架构
- RBAC权限系统
- **Bootstrap框架100%完成(16/16服务已迁移)** 🎉

⏳ **进行中**:
- 单元测试覆盖(目标80%)
- PayPal/Crypto渠道集成
- 完整集成测试

---

## 📚 相关文档

- [CLAUDE.md](CLAUDE.md) - Claude Code开发指南
- [BACKEND_INTEGRITY_REPORT.md](backend/BACKEND_INTEGRITY_REPORT.md) - 后端完整性报告
- [BOOTSTRAP_MIGRATION_FINAL_100PERCENT.md](backend/BOOTSTRAP_MIGRATION_FINAL_100PERCENT.md) - Bootstrap迁移报告

---

**文档版本**: v2.0
**最后更新**: 2025-10-24
**维护人**: 架构团队
