# ==============================================
# mTLS 配置示例
# ==============================================
# 用途: 为所有微服务启用 mTLS 服务间认证
# 使用方法: cp .env.mtls.example .env && source .env
#
# ⚠️  注意:
#   1. 先运行 ./scripts/generate-mtls-certs.sh 生成证书
#   2. 确保证书路径正确
#   3. 生产环境使用绝对路径
# ==============================================

# ============== 全局配置 ==============
# 启用 mTLS（所有服务共用）
export ENABLE_MTLS=true

# CA 证书（所有服务共用，用于验证对方证书）
export TLS_CA_FILE=/home/eric/payment/backend/certs/ca/ca-cert.pem

# ============== Payment Gateway ==============
export TLS_CERT_FILE_PAYMENT_GATEWAY=/home/eric/payment/backend/certs/services/payment-gateway/cert.pem
export TLS_KEY_FILE_PAYMENT_GATEWAY=/home/eric/payment/backend/certs/services/payment-gateway/key.pem
export TLS_CLIENT_CERT=/home/eric/payment/backend/certs/services/payment-gateway/cert.pem
export TLS_CLIENT_KEY=/home/eric/payment/backend/certs/services/payment-gateway/key.pem

# Payment Gateway 调用其他服务（使用 HTTPS）
export ORDER_SERVICE_URL=https://localhost:40004
export RISK_SERVICE_URL=https://localhost:40006
export CHANNEL_SERVICE_URL=https://localhost:40005
export MERCHANT_AUTH_SERVICE_URL=https://localhost:40011
export NOTIFICATION_SERVICE_URL=https://localhost:40008
export ANALYTICS_SERVICE_URL=https://localhost:40009

# ============== Order Service ==============
export TLS_CERT_FILE_ORDER=/home/eric/payment/backend/certs/services/order-service/cert.pem
export TLS_KEY_FILE_ORDER=/home/eric/payment/backend/certs/services/order-service/key.pem

# ============== Risk Service ==============
export TLS_CERT_FILE_RISK=/home/eric/payment/backend/certs/services/risk-service/cert.pem
export TLS_KEY_FILE_RISK=/home/eric/payment/backend/certs/services/risk-service/key.pem

# ============== Channel Adapter ==============
export TLS_CERT_FILE_CHANNEL=/home/eric/payment/backend/certs/services/channel-adapter/cert.pem
export TLS_KEY_FILE_CHANNEL=/home/eric/payment/backend/certs/services/channel-adapter/key.pem

# ============== Merchant Service ==============
export TLS_CERT_FILE_MERCHANT=/home/eric/payment/backend/certs/services/merchant-service/cert.pem
export TLS_KEY_FILE_MERCHANT=/home/eric/payment/backend/certs/services/merchant-service/key.pem

# ============== Admin Service ==============
export TLS_CERT_FILE_ADMIN=/home/eric/payment/backend/certs/services/admin-service/cert.pem
export TLS_KEY_FILE_ADMIN=/home/eric/payment/backend/certs/services/admin-service/key.pem

# ============== Accounting Service ==============
export TLS_CERT_FILE_ACCOUNTING=/home/eric/payment/backend/certs/services/accounting-service/cert.pem
export TLS_KEY_FILE_ACCOUNTING=/home/eric/payment/backend/certs/services/accounting-service/key.pem

# ============== Analytics Service ==============
export TLS_CERT_FILE_ANALYTICS=/home/eric/payment/backend/certs/services/analytics-service/cert.pem
export TLS_KEY_FILE_ANALYTICS=/home/eric/payment/backend/certs/services/analytics-service/key.pem

# ============== Notification Service ==============
export TLS_CERT_FILE_NOTIFICATION=/home/eric/payment/backend/certs/services/notification-service/cert.pem
export TLS_KEY_FILE_NOTIFICATION=/home/eric/payment/backend/certs/services/notification-service/key.pem

# ============== Config Service ==============
export TLS_CERT_FILE_CONFIG=/home/eric/payment/backend/certs/services/config-service/cert.pem
export TLS_KEY_FILE_CONFIG=/home/eric/payment/backend/certs/services/config-service/key.pem

# ============== Settlement Service ==============
export TLS_CERT_FILE_SETTLEMENT=/home/eric/payment/backend/certs/services/settlement-service/cert.pem
export TLS_KEY_FILE_SETTLEMENT=/home/eric/payment/backend/certs/services/settlement-service/key.pem

# ============== Withdrawal Service ==============
export TLS_CERT_FILE_WITHDRAWAL=/home/eric/payment/backend/certs/services/withdrawal-service/cert.pem
export TLS_KEY_FILE_WITHDRAWAL=/home/eric/payment/backend/certs/services/withdrawal-service/key.pem

# ============== KYC Service ==============
export TLS_CERT_FILE_KYC=/home/eric/payment/backend/certs/services/kyc-service/cert.pem
export TLS_KEY_FILE_KYC=/home/eric/payment/backend/certs/services/kyc-service/key.pem

# ============== Cashier Service ==============
export TLS_CERT_FILE_CASHIER=/home/eric/payment/backend/certs/services/cashier-service/cert.pem
export TLS_KEY_FILE_CASHIER=/home/eric/payment/backend/certs/services/cashier-service/key.pem

# ============== Merchant Auth Service ==============
export TLS_CERT_FILE_MERCHANT_AUTH=/home/eric/payment/backend/certs/services/merchant-auth-service/cert.pem
export TLS_KEY_FILE_MERCHANT_AUTH=/home/eric/payment/backend/certs/services/merchant-auth-service/key.pem

# ==============================================
# 使用指南
# ==============================================
#
# 1. 生成证书:
#    cd backend && ./scripts/generate-mtls-certs.sh
#
# 2. 加载环境变量:
#    source .env.mtls.example
#
# 3. 启动单个服务（以 order-service 为例）:
#    export TLS_CERT_FILE=$TLS_CERT_FILE_ORDER
#    export TLS_KEY_FILE=$TLS_KEY_FILE_ORDER
#    go run services/order-service/cmd/main.go
#
# 4. 启动所有服务（需修改 scripts/start-all-services.sh）:
#    ./scripts/start-all-services-mtls.sh
#
# 5. 验证 mTLS:
#    curl -v https://localhost:40004/health \
#      --cacert certs/ca/ca-cert.pem \
#      --cert certs/services/payment-gateway/cert.pem \
#      --key certs/services/payment-gateway/key.pem
#
# ==============================================
