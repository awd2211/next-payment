syntax = "proto3";

package order;

option go_package = "github.com/payment-platform/proto/order;order";

import "google/protobuf/timestamp.proto";

// Order Service - 订单服务
service OrderService {
  // 订单管理
  rpc CreateOrder(CreateOrderRequest) returns (OrderResponse);
  rpc GetOrder(GetOrderRequest) returns (OrderResponse);
  rpc ListOrders(ListOrdersRequest) returns (ListOrdersResponse);
  rpc UpdateOrderStatus(UpdateOrderStatusRequest) returns (OrderResponse);
  rpc CancelOrder(CancelOrderRequest) returns (OrderResponse);

  // 订单统计
  rpc GetOrderStats(GetOrderStatsRequest) returns (OrderStatsResponse);
}

// 订单相关消息
message Order {
  string id = 1;
  string order_no = 2;  // 商户订单号
  string merchant_id = 3;
  string customer_id = 4;
  int64 amount = 5;
  string currency = 6;
  string status = 7;  // pending, processing, paid, failed, cancelled, refunded
  string payment_id = 8;
  string channel = 9;
  string payment_method = 10;
  string description = 11;
  string client_ip = 12;
  map<string, string> metadata = 13;
  google.protobuf.Timestamp paid_at = 14;
  google.protobuf.Timestamp cancelled_at = 15;
  google.protobuf.Timestamp created_at = 16;
  google.protobuf.Timestamp updated_at = 17;
}

message CreateOrderRequest {
  string order_no = 1;
  string merchant_id = 2;
  string customer_id = 3;
  int64 amount = 4;
  string currency = 5;
  string description = 6;
  string client_ip = 7;
  map<string, string> metadata = 8;
}

message GetOrderRequest {
  string id = 1;
  string merchant_id = 2;
}

message ListOrdersRequest {
  string merchant_id = 1;
  string customer_id = 2;
  string status = 3;
  string channel = 4;
  google.protobuf.Timestamp start_time = 5;
  google.protobuf.Timestamp end_time = 6;
  int32 page = 7;
  int32 page_size = 8;
}

message ListOrdersResponse {
  repeated Order orders = 1;
  int32 total = 2;
  int32 page = 3;
  int32 page_size = 4;
}

message UpdateOrderStatusRequest {
  string id = 1;
  string merchant_id = 2;
  string status = 3;
  string payment_id = 4;
}

message CancelOrderRequest {
  string id = 1;
  string merchant_id = 2;
  string reason = 3;
}

message OrderResponse {
  Order order = 1;
}

// 订单统计相关消息
message OrderStats {
  int64 total_orders = 1;
  int64 total_amount = 2;
  int64 success_orders = 3;
  int64 failed_orders = 4;
  double success_rate = 5;
  map<string, int64> channel_distribution = 6;
  map<string, int64> daily_stats = 7;
}

message GetOrderStatsRequest {
  string merchant_id = 1;
  google.protobuf.Timestamp start_time = 2;
  google.protobuf.Timestamp end_time = 3;
}

message OrderStatsResponse {
  OrderStats stats = 1;
}
